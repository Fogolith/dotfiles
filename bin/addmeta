#!/bin/bash

. $1
shift

files=( $* )

if [[ $safetychecks = "y" ]] ; then
    if (( ${#titles[@]} != ${#files[@]} )) ; then
        echo "${#titles[@]} titles != ${#files[@]} files, quitting"
        exit 1
    fi
    if (( ${#descriptions[@]} != ${#files[@]} )) ; then
        echo "${#descriptions[@]} descriptions != ${#files[@]} files, quitting"
        exit 1
    fi
    if [[ -n "$artwork" && ! -f "$artwork" ]]; then
        echo "$artwork: not found"
        exit 1
    fi
fi

atomicparsley=/opt/local/bin/AtomicParsley

declare -i idx=0
for f in ${files[@]} ; do
    $atomicparsley "$f" \
        --stik "TV Show" \
        ${show:+--TVShowName "$show"} \
        ${season:+--TVSeasonNum "$season"} \
        --TVEpisodeNum "$(($idx + ${starting_ep:-0}))" \
        --title "${titles[$idx]}" \
        ${art:+--artwork "$art"} \
        ${year:+--year "$year"} \
        --description "${descriptions[$idx]}" \
        || continue 
    mv -v $f $f.bak
    mv -v ${f%.*}-temp-* $f
    ((idx=$idx + 1))
done